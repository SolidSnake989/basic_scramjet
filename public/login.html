<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
		/>
		<title>Percy Julian Encyclopedia - Login</title>
		<link rel="shortcut icon" href="favicon.ico" />
		<link rel="stylesheet" href="index.css" />
		<style>
			#login-form {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 12px;
				margin-top: 10px;
			}

			#login-form input {
				background: none;
				font-family: inherit;
				font-size: 15px;
				padding: 0 17px;
				height: 48px;
				width: 320px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 50px;
				color: #fff;
				outline: none;
				transition: border-color 0.2s, border-radius 0.1s;
			}

			#login-form input:focus {
				border-color: rgba(255, 255, 255, 0.5);
				border-radius: 6px;
			}

			#login-form button {
				font-family: inherit;
				font-size: 15px;
				padding: 0 28px;
				height: 44px;
				border: none;
				border-radius: 50px;
				background: rgba(255, 255, 255, 0.1);
				color: #fff;
				cursor: pointer;
				transition: background 0.2s;
				margin-top: 4px;
			}

			#login-form button:hover {
				background: rgba(255, 255, 255, 0.2);
			}

			#login-error {
				color: #ff6666 !important;
			}
		</style>
	</head>

	<body>
		<div class="flex-center logo-wrapper header-center">
			<h1>Percy Julian Encyclopedia</h1>
		</div>
		<div class="flex-center desc left-margin">
			<p>Please log in to access the encyclopedia.</p>
		</div>

		<form id="login-form">
			<input
				id="login-username"
				type="text"
				placeholder="Username"
				autocomplete="username"
			/>
			<input
				id="login-password"
				type="password"
				placeholder="Password"
				autocomplete="current-password"
			/>
			<button type="submit">Log In</button>
		</form>
		<div class="flex-center desc left-margin">
			<p id="login-error"></p>
		</div>

		<div id="logged-in" style="display: none;">
			<div class="flex-center desc left-margin">
				<p style="color: rgba(255,255,255,0.7);">You are logged in. You may close this tab.</p>
			</div>
		</div>


		<script>
			const form = document.getElementById("login-form");
			const username = document.getElementById("login-username");
			const password = document.getElementById("login-password");
			const error = document.getElementById("login-error");
			const loggedIn = document.getElementById("logged-in");

			form.addEventListener("submit", async (e) => {
				e.preventDefault();
				error.textContent = "";

				const res = await fetch("/api/login", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ username: username.value, password: password.value }),
				});

				if (res.ok) {
					// Open the real site in an about:blank tab
					var win = window.open("about:blank", "_blank");
					var iframe = win.document.createElement("iframe");
					iframe.style.width = "100%";
					iframe.style.height = "100%";
					iframe.style.border = "none";
					iframe.style.position = "fixed";
					iframe.style.top = "0";
					iframe.style.left = "0";
					iframe.src = location.origin + "/";
					win.document.body.style.margin = "0";
					win.document.body.appendChild(iframe);

					// Hide form, show logged-in message
					form.style.display = "none";
					loggedIn.style.display = "block";
				} else {
					error.textContent = "Incorrect username or password.";
					password.value = "";
					username.focus();
				}
			});
		</script>
	</body>
</html>
